(function (factory) {
    if (typeof module === 'object' && typeof module.exports === 'object') {
        var v = factory(require, exports); if (v !== undefined) module.exports = v;
    }
    else if (typeof define === 'function' && define.amd) {
        define(["require", "exports", './lang'], factory);
    }
})(function (require, exports) {
    "use strict";
    const lang_1 = require('./lang');
    function emit(target, event) {
        if (target.dispatchEvent &&
            ((target.ownerDocument && target.ownerDocument.createEvent) ||
                (target.document && target.document.createEvent) ||
                target.createEvent) /* matches document */) {
            const nativeEvent = (target.ownerDocument || target.document || target).createEvent('HTMLEvents');
            nativeEvent.initEvent(event.type, Boolean(event.bubbles), Boolean(event.cancelable));
            for (let key in event) {
                if (!(key in nativeEvent)) {
                    nativeEvent[key] = event[key];
                }
            }
            return target.dispatchEvent(nativeEvent);
        }
        if (target.emit) {
            if (target.removeListener) {
                // Node.js EventEmitter
                target.emit(event.type, event);
                return false;
            }
            else if (target.on) {
                // Dojo Evented or similar
                target.emit(event);
                return false;
            }
        }
        throw new Error('Target must be an event emitter');
    }
    exports.emit = emit;
    function on(target, type, listener, capture) {
        if (Array.isArray(type)) {
            let handles = type.map(function (type) {
                return on(target, type, listener, capture);
            });
            return lang_1.createCompositeHandle(...handles);
        }
        const callback = function () {
            listener.apply(this, arguments);
        };
        // DOM EventTarget
        if (target.addEventListener && target.removeEventListener) {
            target.addEventListener(type, callback, capture);
            return lang_1.createHandle(function () {
                target.removeEventListener(type, callback, capture);
            });
        }
        if (target.on) {
            // EventEmitter
            if (target.removeListener) {
                target.on(type, callback);
                return lang_1.createHandle(function () {
                    target.removeListener(type, callback);
                });
            }
            else if (target.emit) {
                return target.on(type, listener);
            }
        }
        throw new TypeError('Unknown event emitter object');
    }
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.default = on;
    function once(target, type, listener, capture) {
        const handle = on(target, type, function () {
            handle.destroy();
            return listener.apply(this, arguments);
        }, capture);
        return handle;
    }
    exports.once = once;
    function pausable(target, type, listener, capture) {
        let paused;
        const handle = on(target, type, function () {
            if (!paused) {
                return listener.apply(this, arguments);
            }
        }, capture);
        handle.pause = function () {
            paused = true;
        };
        handle.resume = function () {
            paused = false;
        };
        return handle;
    }
    exports.pausable = pausable;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0lBQ0EsdUJBQW9ELFFBQVEsQ0FBQyxDQUFBO0lBeUI3RCxjQUE0QyxNQUFXLEVBQUUsS0FBc0I7UUFDOUUsRUFBRSxDQUFDLENBQ0YsTUFBTSxDQUFDLGFBQWE7WUFDbkIsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxhQUFhLElBQUksTUFBTSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUM7Z0JBQzNELENBQUMsTUFBTSxDQUFDLFFBQVEsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQztnQkFDaEQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLHNCQUN0QixDQUFDLENBQUMsQ0FBQztZQUNGLE1BQU0sV0FBVyxHQUFHLENBQUMsTUFBTSxDQUFDLGFBQWEsSUFBSSxNQUFNLENBQUMsUUFBUSxJQUFJLE1BQU0sQ0FBQyxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNsRyxXQUFXLENBQUMsU0FBUyxDQUNwQixLQUFLLENBQUMsSUFBSSxFQUNWLE9BQU8sQ0FBbUIsS0FBTSxDQUFDLE9BQU8sQ0FBQyxFQUN6QyxPQUFPLENBQW1CLEtBQU0sQ0FBQyxVQUFVLENBQUMsQ0FDNUMsQ0FBQztZQUVGLEdBQUcsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZCLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUMzQixXQUFXLENBQUMsR0FBRyxDQUFDLEdBQVUsS0FBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUN2QyxDQUFDO1lBQ0YsQ0FBQztZQUVELE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzFDLENBQUM7UUFFRCxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMs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LENBQUM7UUFFWixNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ2YsQ0FBQztJQVBlLFlBQUksT0FPbkIsQ0FBQTtJQWlCRCxrQkFBeUIsTUFBVyxFQUFFLElBQVMsRUFBRSxRQUFhLEVBQUUsT0FBaUI7UUFDaEYsSUFBSSxNQUFlLENBQUM7UUFFcEIsTUFBTSxNQUFNLEdBQW9CLEVBQUUsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFO1lBQ2hELEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDYixNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDeEMsQ0FBQztRQUNGLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUVaLE1BQU0sQ0FBQyxLQUFLLEdBQUc7WUFDZCxNQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ2YsQ0FBQyxDQUFDO1FBRUYsTUFBTSxDQUFDLE1BQU0sR0FBRztZQUNmLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDaEIsQ0FBQyxDQUFDO1FBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUNmLENBQUM7SUFsQmUsZ0JBQVEsV0FrQnZCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIYW5kbGUsIEV2ZW50T2JqZWN0IH0gZnJvbSAnLi9pbnRlcmZhY2VzJztcbmltcG9ydCB7IGNyZWF0ZUhhbmRsZSwgY3JlYXRlQ29tcG9zaXRlSGFuZGxlIH0gZnJvbSAnLi9sYW5nJztcbmltcG9ydCBFdmVudGVkIGZyb20gJy4vRXZlbnRlZCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnRDYWxsYmFjayB7XG5cdChldmVudDogRXZlbnRPYmplY3QpOiB2b2lkO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEV2ZW50RW1pdHRlciB7XG5cdG9uKGV2ZW50OiBzdHJpbmcsIGxpc3RlbmVyOiBFdmVudENhbGxiYWNrKTogRXZlbnRFbWl0dGVyO1xuXHRyZW1vdmVMaXN0ZW5lcihldmVudDogc3RyaW5nLCBsaXN0ZW5lcjogRXZlbnRDYWxsYmFjayk6IEV2ZW50RW1pdHRlcjtcbn1cblxuaW50ZXJmYWNlIERPTUV2ZW50T2JqZWN0IGV4dGVuZHMgRXZlbnRPYmplY3Qge1xuXHRidWJibGVzOiBib29sZWFuO1xuXHRjYW5jZWxhYmxlOiBib29sZWFuO1xufVxuXG4vKipcbiAqIFByb3ZpZGVzIGEgbm9ybWFsaXplZCBtZWNoYW5pc20gZm9yIGRpc3BhdGNoaW5nIGV2ZW50cyBmb3IgZXZlbnQgZW1pdHRlcnMsIEV2ZW50ZWQgb2JqZWN0cywgb3IgRE9NIG5vZGVzLlxuICogQHBhcmFtIHRhcmdldCBUaGUgdGFyZ2V0IHRvIGVtaXQgdGhlIGV2ZW50IGZyb21cbiAqIEBwYXJhbSBldmVudCBUaGUgZXZlbnQgb2JqZWN0IHRvIGVtaXRcbiAqIEByZXR1cm4gQm9vbGVhbiBpbmRpY2F0aW5nIGlmIHByZXZlbnREZWZhdWx0IHdhcyBjYWxsZWQgb24gdGhlIGV2ZW50IG9iamVjdCAob25seSByZWxldmFudCBmb3IgRE9NIGV2ZW50cztcbiAqICAgICBhbHdheXMgZmFsc2UgZm9yIG90aGVyIGV2ZW50IGVtaXR0ZXJzKVxuICovXG5leHBvcnQgZnVuY3Rpb24gZW1pdDxUIGV4dGVuZHMgRXZlbnRPYmplY3Q+KHRhcmdldDogRXZlbnRlZCB8IEV2ZW50VGFyZ2V0IHwgRXZlbnRFbWl0dGVyLCBldmVudDogVCB8IEV2ZW50T2JqZWN0KTogYm9vbGVhbjtcbmV4cG9ydCBmdW5jdGlvbiBlbWl0PFQgZXh0ZW5kcyBFdmVudE9iamVjdD4odGFyZ2V0OiBhbnksIGV2ZW50OiBUIHwgRXZlbnRPYmplY3QpOiBib29sZWFuIHtcblx0aWYgKFxuXHRcdHRhcmdldC5kaXNwYXRjaEV2ZW50ICYmIC8qIGluY2x1ZGVzIHdpbmRvdyBhbmQgZG9jdW1lbnQgKi9cblx0XHRcdCgodGFyZ2V0Lm93bmVyRG9jdW1lbnQgJiYgdGFyZ2V0Lm93bmVyRG9jdW1lbnQuY3JlYXRlRXZlbnQpIHx8IC8qIG1hdGNoZXMgbm9kZXMgKi9cblx0XHRcdCh0YXJnZXQuZG9jdW1lbnQgJiYgdGFyZ2V0LmRvY3VtZW50LmNyZWF0ZUV2ZW50KSB8fCAvKiBtYXRjaGVzIHdpbmRvdyAqL1xuXHRcdFx0dGFyZ2V0LmNyZWF0ZUV2ZW50KSAvKiBtYXRjaGVzIGRvY3VtZW50ICovXG5cdCkge1xuXHRcdGNvbnN0IG5hdGl2ZUV2ZW50ID0gKHRhcmdldC5vd25lckRvY3VtZW50IHx8IHRhcmdldC5kb2N1bWVudCB8fCB0YXJnZXQpLmNyZWF0ZUV2ZW50KCdIVE1MRXZlbnRzJyk7XG5cdFx0bmF0aXZlRXZlbnQuaW5pdEV2ZW50KFxuXHRcdFx0ZXZlbnQudHlwZSxcblx0XHRcdEJvb2xlYW4oKDxET01FdmVudE9iamVjdD4gZXZlbnQpLmJ1YmJsZXMpLFxuXHRcdFx0Qm9vbGVhbigoPERPTUV2ZW50T2JqZWN0PiBldmVudCkuY2FuY2VsYWJsZSlcblx0XHQpO1xuXG5cdFx0Zm9yIChsZXQga2V5IGluIGV2ZW50KSB7XG5cdFx0XHRpZiAoIShrZXkgaW4gbmF0aXZlRXZlbnQpKSB7XG5cdFx0XHRcdG5hdGl2ZUV2ZW50W2tleV0gPSAoPGFueT4gZXZlbnQpW2tleV07XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRhcmdldC5kaXNwYXRjaEV2ZW50KG5hdGl2ZUV2ZW50KTtcblx0fVxuXG5cdGlmICh0YXJnZXQuZW1pdCkge1xuXHRcdGlmICh0YXJnZXQucmVtb3ZlTGlzdGVuZXIpIHtcblx0XHRcdC8vIE5vZGUuanMgRXZlbnRFbWl0dGVyXG5cdFx0XHR0YXJnZXQuZW1pdChldmVudC50eXBlLCBldmVudCk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHRcdGVsc2UgaWYgKHRhcmdldC5vbikge1xuXHRcdFx0Ly8gRG9qbyBFdmVudGVkIG9yIHNpbWlsYXJcblx0XHRcdHRhcmdldC5lbWl0KGV2ZW50KTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH1cblxuXHR0aHJvdyBuZXcgRXJyb3IoJ1RhcmdldCBtdXN0IGJlIGFuIGV2ZW50IGVtaXR0ZXInKTtcbn1cblxuLyoqXG4gKiBQcm92aWRlcyBhIG5vcm1hbGl6ZWQgbWVjaGFuaXNtIGZvciBsaXN0ZW5pbmcgdG8gZXZlbnRzIGZyb20gZXZlbnQgZW1pdHRlcnMsIEV2ZW50ZWQgb2JqZWN0cywgb3IgRE9NIG5vZGVzLlxuICogQHBhcmFtIHRhcmdldCBUYXJnZXQgdG8gbGlzdGVuIGZvciBldmVudCBvblxuICogQHBhcmFtIHR5cGUgRXZlbnQgZXZlbnQgdHlwZShzKSB0byBsaXN0ZW4gZm9yOyBtYXkgYSBzdHJpbmcgb3IgYW4gYXJyYXkgb2Ygc3RyaW5nc1xuICogQHBhcmFtIGxpc3RlbmVyIENhbGxiYWNrIHRvIGhhbmRsZSB0aGUgZXZlbnQgd2hlbiBpdCBmaXJlc1xuICogQHBhcmFtIGNhcHR1cmUgV2hldGhlciB0aGUgbGlzdGVuZXIgc2hvdWxkIGJlIHJlZ2lzdGVyZWQgaW4gdGhlIGNhcHR1cmUgcGhhc2UgKERPTSBldmVudHMgb25seSlcbiAqIEByZXR1cm4gQSBoYW5kbGUgd2hpY2ggd2lsbCByZW1vdmUgdGhlIGxpc3RlbmVyIHdoZW4gZGVzdHJveSBpcyBjYWxsZWRcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gb24odGFyZ2V0OiBFdmVudFRhcmdldCwgdHlwZTogc3RyaW5nIHwgc3RyaW5nW10sIGxpc3RlbmVyOiBFdmVudENhbGxiYWNrLCBjYXB0dXJlPzogYm9vbGVhbik6IEhhbmRsZTtcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG9uKHRhcmdldDogRXZlbnRFbWl0dGVyIHwgRXZlbnRlZCwgdHlwZTogc3RyaW5nIHwgc3RyaW5nW10sIGxpc3RlbmVyOiBFdmVudENhbGxiYWNrKTogSGFuZGxlO1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gb24odGFyZ2V0OiBhbnksIHR5cGU6IGFueSwgbGlzdGVuZXI6IGFueSwgY2FwdHVyZT86IGJvb2xlYW4pOiBIYW5kbGUge1xuXHRpZiAoQXJyYXkuaXNBcnJheSh0eXBlKSkge1xuXHRcdGxldCBoYW5kbGVzOiBIYW5kbGVbXSA9IHR5cGUubWFwKGZ1bmN0aW9uICh0eXBlOiBzdHJpbmcpOiBIYW5kbGUge1xuXHRcdFx0cmV0dXJuIG9uKHRhcmdldCwgdHlwZSwgbGlzdGVuZXIsIGNhcHR1cmUpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGNyZWF0ZUNvbXBvc2l0ZUhhbmRsZSguLi5oYW5kbGVzKTtcblx0fVxuXG5cdGNvbnN0IGNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuXHRcdGxpc3RlbmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cdH07XG5cblx0Ly8gRE9NIEV2ZW50VGFyZ2V0XG5cdGlmICh0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lciAmJiB0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcikge1xuXHRcdHRhcmdldC5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGNhbGxiYWNrLCBjYXB0dXJlKTtcblx0XHRyZXR1cm4gY3JlYXRlSGFuZGxlKGZ1bmN0aW9uICgpIHtcblx0XHRcdHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGNhbGxiYWNrLCBjYXB0dXJlKTtcblx0XHR9KTtcblx0fVxuXG5cdGlmICh0YXJnZXQub24pIHtcblx0XHQvLyBFdmVudEVtaXR0ZXJcblx0XHRpZiAodGFyZ2V0LnJlbW92ZUxpc3RlbmVyKSB7XG5cdFx0XHR0YXJnZXQub24odHlwZSwgY2FsbGJhY2spO1xuXHRcdFx0cmV0dXJuIGNyZWF0ZUhhbmRsZShmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHRhcmdldC5yZW1vdmVMaXN0ZW5lcih0eXBlLCBjYWxsYmFjayk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0Ly8gRXZlbnRlZFxuXHRcdGVsc2UgaWYgKHRhcmdldC5lbWl0KSB7XG5cdFx0XHRyZXR1cm4gdGFyZ2V0Lm9uKHR5cGUsIGxpc3RlbmVyKTtcblx0XHR9XG5cdH1cblxuXHR0aHJvdyBuZXcgVHlwZUVycm9yKCdVbmtub3duIGV2ZW50IGVtaXR0ZXIgb2JqZWN0Jyk7XG59XG5cbi8qKlxuICogUHJvdmlkZXMgYSBtZWNoYW5pc20gZm9yIGxpc3RlbmluZyB0byB0aGUgbmV4dCBvY2N1cnJlbmNlIG9mIGFuIGV2ZW50IGZyb20gZXZlbnRcbiAqIGVtaXR0ZXJzLCBFdmVudGVkIG9iamVjdHMsIG9yIERPTSBub2Rlcy5cbiAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IHRvIGxpc3RlbiBmb3IgZXZlbnQgb25cbiAqIEBwYXJhbSB0eXBlIEV2ZW50IGV2ZW50IHR5cGUocykgdG8gbGlzdGVuIGZvcjsgbWF5IGJlIGEgc3RyaW5nIG9yIGFuIGFycmF5IG9mIHN0cmluZ3NcbiAqIEBwYXJhbSBsaXN0ZW5lciBDYWxsYmFjayB0byBoYW5kbGUgdGhlIGV2ZW50IHdoZW4gaXQgZmlyZXNcbiAqIEBwYXJhbSBjYXB0dXJlIFdoZXRoZXIgdGhlIGxpc3RlbmVyIHNob3VsZCBiZSByZWdpc3RlcmVkIGluIHRoZSBjYXB0dXJlIHBoYXNlIChET00gZXZlbnRzIG9ubHkpXG4gKiBAcmV0dXJuIEEgaGFuZGxlIHdoaWNoIHdpbGwgcmVtb3ZlIHRoZSBsaXN0ZW5lciB3aGVuIGRlc3Ryb3kgaXMgY2FsbGVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBvbmNlKHRhcmdldDogRXZlbnRUYXJnZXQsIHR5cGU6IHN0cmluZyB8IHN0cmluZ1tdLCBsaXN0ZW5lcjogRXZlbnRDYWxsYmFjaywgY2FwdHVyZT86IGJvb2xlYW4pOiBIYW5kbGU7XG5leHBvcnQgZnVuY3Rpb24gb25jZSh0YXJnZXQ6IEV2ZW50RW1pdHRlciB8IEV2ZW50ZWQsIHR5cGU6IHN0cmluZyB8IHN0cmluZ1tdLCBsaXN0ZW5lcjogRXZlbnRDYWxsYmFjayk6IEhhbmRsZTtcbmV4cG9ydCBmdW5jdGlvbiBvbmNlKHRhcmdldDogYW55LCB0eXBlOiBhbnksIGxpc3RlbmVyOiBhbnksIGNhcHR1cmU/OiBib29sZWFuKTogSGFuZGxlIHtcblx0Y29uc3QgaGFuZGxlID0gb24odGFyZ2V0LCB0eXBlLCBmdW5jdGlvbiAoKSB7XG5cdFx0aGFuZGxlLmRlc3Ryb3koKTtcblx0XHRyZXR1cm4gbGlzdGVuZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblx0fSwgY2FwdHVyZSk7XG5cblx0cmV0dXJuIGhhbmRsZTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQYXVzYWJsZUhhbmRsZSBleHRlbmRzIEhhbmRsZSB7XG5cdHBhdXNlKCk6IHZvaWQ7XG5cdHJlc3VtZSgpOiB2b2lkO1xufVxuXG4vKipcbiAqIFByb3ZpZGVzIGEgbWVjaGFuaXNtIGZvciBjcmVhdGluZyBwYXVzYWJsZSBsaXN0ZW5lcnMgZm9yIGV2ZW50cyBmcm9tIGV2ZW50IGVtaXR0ZXJzLCBFdmVudGVkIG9iamVjdHMsIG9yIERPTSBub2Rlcy5cbiAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IHRvIGxpc3RlbiBmb3IgZXZlbnQgb25cbiAqIEBwYXJhbSB0eXBlIEV2ZW50IGV2ZW50IHR5cGUocykgdG8gbGlzdGVuIGZvcjsgbWF5IGEgc3RyaW5nIG9yIGFuIGFycmF5IG9mIHN0cmluZ3NcbiAqIEBwYXJhbSBsaXN0ZW5lciBDYWxsYmFjayB0byBoYW5kbGUgdGhlIGV2ZW50IHdoZW4gaXQgZmlyZXNcbiAqIEBwYXJhbSBjYXB0dXJlIFdoZXRoZXIgdGhlIGxpc3RlbmVyIHNob3VsZCBiZSByZWdpc3RlcmVkIGluIHRoZSBjYXB0dXJlIHBoYXNlIChET00gZXZlbnRzIG9ubHkpXG4gKiBAcmV0dXJuIEEgaGFuZGxlIHdpdGggYWRkaXRpb25hbCBwYXVzZSBhbmQgcmVzdW1lIG1ldGhvZHM7IHRoZSBsaXN0ZW5lciB3aWxsIG5ldmVyIGZpcmUgd2hlbiBwYXVzZWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhdXNhYmxlKHRhcmdldDogRXZlbnRUYXJnZXQsIHR5cGU6IHN0cmluZyB8IHN0cmluZ1tdLCBsaXN0ZW5lcjogRXZlbnRDYWxsYmFjaywgY2FwdHVyZT86IGJvb2xlYW4pOiBQYXVzYWJsZUhhbmRsZTtcbmV4cG9ydCBmdW5jdGlvbiBwYXVzYWJsZSh0YXJnZXQ6IEV2ZW50RW1pdHRlciB8IEV2ZW50ZWQsIHR5cGU6IHN0cmluZyB8IHN0cmluZ1tdLCBsaXN0ZW5lcjogRXZlbnRDYWxsYmFjayk6IFBhdXNhYmxlSGFuZGxlO1xuZXhwb3J0IGZ1bmN0aW9uIHBhdXNhYmxlKHRhcmdldDogYW55LCB0eXBlOiBhbnksIGxpc3RlbmVyOiBhbnksIGNhcHR1cmU/OiBib29sZWFuKTogUGF1c2FibGVIYW5kbGUge1xuXHRsZXQgcGF1c2VkOiBib29sZWFuO1xuXG5cdGNvbnN0IGhhbmRsZSA9IDxQYXVzYWJsZUhhbmRsZT4gb24odGFyZ2V0LCB0eXBlLCBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKCFwYXVzZWQpIHtcblx0XHRcdHJldHVybiBsaXN0ZW5lci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXHRcdH1cblx0fSwgY2FwdHVyZSk7XG5cblx0aGFuZGxlLnBhdXNlID0gZnVuY3Rpb24gKCkge1xuXHRcdHBhdXNlZCA9IHRydWU7XG5cdH07XG5cblx0aGFuZGxlLnJlc3VtZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRwYXVzZWQgPSBmYWxzZTtcblx0fTtcblxuXHRyZXR1cm4gaGFuZGxlO1xufVxuIl19