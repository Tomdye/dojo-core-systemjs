(function (factory) {
    if (typeof module === 'object' && typeof module.exports === 'object') {
        var v = factory(require, exports); if (v !== undefined) module.exports = v;
    }
    else if (typeof define === 'function' && define.amd) {
        define(["require", "exports", './string'], factory);
    }
})(function (require, exports) {
    "use strict";
    const string_1 = require('./string');
    const BASE64_KEYSTR = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
    function decodeUtf8EncodedCodePoint(codePoint, validationRange = [0, Infinity], checkSurrogate) {
        if (codePoint < validationRange[0] || codePoint > validationRange[1]) {
            throw Error('Invalid continuation byte');
        }
        if (checkSurrogate && codePoint >= string_1.HIGH_SURROGATE_MIN && codePoint <= string_1.LOW_SURROGATE_MAX) {
            throw Error('Surrogate is not a scalar value');
        }
        let encoded = '';
        if (codePoint > 0xFFFF) {
            codePoint -= 0x010000;
            encoded += String.fromCharCode(codePoint >>> 0x10 & 0x03FF | string_1.HIGH_SURROGATE_MIN);
            codePoint = string_1.LOW_SURROGATE_MIN | codePoint & 0x03FF;
        }
        encoded += String.fromCharCode(codePoint);
        return encoded;
    }
    function validateUtf8EncodedCodePoint(codePoint) {
        if ((codePoint & 0xC0) !== 0x80) {
            throw Error('Invalid continuation byte');
        }
    }
    /**
     * Provides facilities for encoding a string into an ASCII-encoded byte buffer and
     * decoding an ASCII-encoded byte buffer into a string.
     */
    exports.ascii = {
        /**
         * Encodes a string into an ASCII-encoded byte buffer.
         *
         * @param data The text string to encode
         */
        encode(data) {
            if (data == null) {
                return [];
            }
            const buffer = [];
            for (let i = 0, length = data.length; i < length; i++) {
                buffer[i] = data.charCodeAt(i);
            }
            return buffer;
        },
        /**
         * Decodes an ASCII-encoded byte buffer into a string.
         *
         * @param data The byte buffer to decode
         */
        decode(data) {
            if (data == null) {
                return '';
            }
            let decoded = '';
            for (let i = 0, length = data.length; i < length; i++) {
                decoded += String.fromCharCode(data[i]);
            }
            return decoded;
        }
    };
    /**
     * Provides facilities for encoding a string into a Base64-encoded byte buffer and
     * decoding a Base64-encoded byte buffer into a string.
     */
    exports.base64 = {
        /**
         * Encodes a Base64-encoded string into a Base64 byte buffer.
         *
         * @param data The Base64-encoded string to encode
         */
        encode(data) {
            if (data == null) {
                return [];
            }
            const buffer = [];
            let i = 0;
            let length = data.length;
            while (data[--length] === '=') { }
            while (i < length) {
                let encoded = BASE64_KEYSTR.indexOf(data[i++]) << 18;
                if (i <= length) {
                    encoded |= BASE64_KEYSTR.indexOf(data[i++]) << 12;
                }
                if (i <= length) {
                    encoded |= BASE64_KEYSTR.indexOf(data[i++]) << 6;
                }
                if (i <= length) {
                    encoded |= BASE64_KEYSTR.indexOf(data[i++]);
                }
                buffer.push((encoded >>> 16) & 0xff);
                buffer.push((encoded >>> 8) & 0xff);
                buffer.push(encoded & 0xff);
            }
            while (buffer[buffer.length - 1] === 0) {
                buffer.pop();
            }
            return buffer;
        },
        /**
         * Decodes a Base64-encoded byte buffer into a Base64-encoded string.
         *
         * @param data The byte buffer to decode
         */
        decode(data) {
            if (data == null) {
                return '';
            }
            let decoded = '';
            let i = 0;
            for (let length = data.length - (data.length % 3); i < length;) {
                let encoded = data[i++] << 16 | data[i++] << 8 | data[i++];
                decoded += BASE64_KEYSTR.charAt((encoded >>> 18) & 0x3F);
                decoded += BASE64_KEYSTR.charAt((encoded >>> 12) & 0x3F);
                decoded += BASE64_KEYSTR.charAt((encoded >>> 6) & 0x3F);
                decoded += BASE64_KEYSTR.charAt(encoded & 0x3F);
            }
            if (data.length % 3 === 1) {
                let encoded = data[i++] << 16;
                decoded += BASE64_KEYSTR.charAt((encoded >>> 18) & 0x3f);
                decoded += BASE64_KEYSTR.charAt((encoded >>> 12) & 0x3f);
                decoded += '==';
            }
            else if (data.length % 3 === 2) {
                let encoded = data[i++] << 16 | data[i++] << 8;
                decoded += BASE64_KEYSTR.charAt((encoded >>> 18) & 0x3f);
                decoded += BASE64_KEYSTR.charAt((encoded >>> 12) & 0x3f);
                decoded += BASE64_KEYSTR.charAt((encoded >>> 6) & 0x3f);
                decoded += '=';
            }
            return decoded;
        }
    };
    /**
     * Provides facilities for encoding a string into a hex-encoded byte buffer and
     * decoding a hex-encoded byte buffer into a string.
     */
    exports.hex = {
        /**
         * Encodes a string into a hex-encoded byte buffer.
         *
         * @param data The hex-encoded string to encode
         */
        encode(data) {
            if (data == null) {
                return [];
            }
            const buffer = [];
            for (let i = 0, length = data.length; i < length; i += 2) {
                let encodedChar = parseInt(data.substr(i, 2), 16);
                buffer.push(encodedChar);
            }
            return buffer;
        },
        /**
         * Decodes a hex-encoded byte buffer into a hex-encoded string.
         *
         * @param data The byte buffer to decode
         */
        decode(data) {
            if (data == null) {
                return '';
            }
            let decoded = '';
            for (let i = 0, length = data.length; i < length; i++) {
                decoded += data[i].toString(16).toUpperCase();
            }
            return decoded;
        }
    };
    /**
     * Provides facilities for encoding a string into a UTF-8-encoded byte buffer and
     * decoding a UTF-8-encoded byte buffer into a string.
     * Inspired by the work of: https://github.com/mathiasbynens/utf8.js
     */
    exports.utf8 = {
        /**
         * Encodes a string into a UTF-8-encoded byte buffer.
         *
         * @param data The text string to encode
         */
        encode(data) {
            if (data == null) {
                return [];
            }
            const buffer = [];
            for (let i = 0, length = data.length; i < length; i++) {
                let encodedChar = data.charCodeAt(i);
                /**
                 * Surrogates
                 * http://en.wikipedia.org/wiki/Universal_Character_Set_characters
                 */
                if (encodedChar >= string_1.HIGH_SURROGATE_MIN && encodedChar <= string_1.HIGH_SURROGATE_MAX) {
                    let lowSurrogate = data.charCodeAt(i + 1);
                    if (lowSurrogate >= string_1.LOW_SURROGATE_MIN && lowSurrogate <= string_1.LOW_SURROGATE_MAX) {
                        encodedChar = 0x010000 + (encodedChar - string_1.HIGH_SURROGATE_MIN) * 0x0400 + (lowSurrogate - string_1.LOW_SURROGATE_MIN);
                        i++;
                    }
                }
                if (encodedChar < 0x80) {
                    buffer.push(encodedChar);
                }
                else {
                    if (encodedChar < 0x800) {
                        buffer.push(((encodedChar >> 0x06) & 0x1F) | 0xC0);
                    }
                    else if (encodedChar < 0x010000) {
                        if (encodedChar >= string_1.HIGH_SURROGATE_MIN && encodedChar <= string_1.LOW_SURROGATE_MAX) {
                            throw Error('Surrogate is not a scalar value');
                        }
                        buffer.push(((encodedChar >> 0x0C) & 0x0F) | 0xE0);
                        buffer.push(((encodedChar >> 0x06) & 0x3F) | 0x80);
                    }
                    else if (encodedChar < 0x200000) {
                        buffer.push(((encodedChar >> 0x12) & 0x07) | 0xF0);
                        buffer.push(((encodedChar >> 0x0C) & 0x3F) | 0x80);
                        buffer.push(((encodedChar >> 0x06) & 0x3F) | 0x80);
                    }
                    buffer.push((encodedChar & 0x3F) | 0x80);
                }
            }
            return buffer;
        },
        /**
         * Decodes a UTF-8-encoded byte buffer into a string.
         *
         * @param data The byte buffer to decode
         */
        decode(data) {
            if (data == null) {
                return '';
            }
            let decoded = '';
            for (let i = 0, length = data.length; i < length; i++) {
                let byte1 = data[i] & 0xFF;
                if ((byte1 & 0x80) === 0) {
                    decoded += decodeUtf8EncodedCodePoint(byte1);
                }
                else if ((byte1 & 0xE0) === 0xC0) {
                    let byte2 = data[++i] & 0xFF;
                    validateUtf8EncodedCodePoint(byte2);
                    byte2 = byte2 & 0x3F;
                    let encodedByte = ((byte1 & 0x1F) << 0x06) | byte2;
                    decoded += decodeUtf8EncodedCodePoint(encodedByte, [0x80, Infinity]);
                }
                else if ((byte1 & 0xF0) === 0xE0) {
                    let byte2 = data[++i] & 0xFF;
                    validateUtf8EncodedCodePoint(byte2);
                    byte2 = byte2 & 0x3F;
                    let byte3 = data[++i] & 0xFF;
                    validateUtf8EncodedCodePoint(byte3);
                    byte3 = byte3 & 0x3F;
                    let encodedByte = ((byte1 & 0x1F) << 0x0C) | (byte2 << 0x06) | byte3;
                    decoded += decodeUtf8EncodedCodePoint(encodedByte, [0x0800, Infinity], true);
                }
                else if ((byte1 & 0xF8) === 0xF0) {
                    let byte2 = data[++i] & 0xFF;
                    validateUtf8EncodedCodePoint(byte2);
                    byte2 = byte2 & 0x3F;
                    let byte3 = data[++i] & 0xFF;
                    validateUtf8EncodedCodePoint(byte3);
                    byte3 = byte3 & 0x3F;
                    let byte4 = data[++i] & 0xFF;
                    validateUtf8EncodedCodePoint(byte4);
                    byte4 = byte4 & 0x3F;
                    let encodedByte = ((byte1 & 0x1F) << 0x0C) | (byte2 << 0x0C) | (byte3 << 0x06) | byte4;
                    decoded += decodeUtf8EncodedCodePoint(encodedByte, [0x010000, 0x10FFFF]);
                }
                else {
                    validateUtf8EncodedCodePoint(byte1);
                }
            }
            return decoded;
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW5jb2RpbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZW5jb2RpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0lBQUEseUJBQTZGLFVBQVUsQ0FBQyxDQUFBO0lBRXhHLE1BQU0sYUFBYSxHQUFHLG1FQUFtRSxDQUFDO0lBRTFGLG9DQUFvQyxTQUFpQixFQUFFLGVBQWUsR0FBYSxDQUFFLENBQUMsRUFBRSxRQUFRLENBQUUsRUFBRSxjQUF3QjtRQUMzSCxFQUFFLENBQUMsQ0FBQyxTQUFTLEdBQUcsZUFBZSxDQUFDLENBQUMsQ0FBQyxJQUFJLFNBQVMsR0FBRyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RFLE1BQU0sS0FBSyxDQUFDLDJCQUEyQixDQUFDLENBQUM7UUFDMUMsQ0FBQztRQUVELEVBQUUsQ0FBQyxDQUFDLGNBQWMsSUFBSSxTQUFTLElBQUksMkJBQWtCLElBQUksU0FBUyxJQUFJLDBCQUFpQixDQUFDLENBQUMsQ0FBQztZQUN6RixNQUFNLEtBQUssQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO1FBQ2hELENBQUM7UUFFRCxJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFFakIsRUFBRSxDQUFDLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDeEIsU0FBUyxJQUFJLFFBQVEsQ0FBQztZQUN0QixPQUFPLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxTQUFTLEtBQUssSUFBSSxHQUFHLE1BQU0sR0FBRywyQkFBa0IsQ0FBQyxDQUFDO1lBQ2pGLFNBQVMsR0FBRywwQkFBaUIsR0FBRyxTQUFTLEdBQUcsTUFBTSxDQUFDO1FBQ3BELENBQUM7UUFFRCxPQUFPLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUUxQyxNQUFNLENBQUMsT0FBTyxDQUFDO0lBQ2hCLENBQUM7SUFFRCxzQ0FBc0MsU0FBaUI7UUFDdEQsRUFBRSxDQUFDLENB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QUksQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztvQkFDbkQsT0FBTyxJQUFJLDBCQUEwQixDQUFDLFdBQVcsRUFBRSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUN0RSxDQUFDO2dCQUNELElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUNsQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7b0JBQzdCLDRCQUE0QixDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUNwQyxLQUFLLEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQztvQkFFckIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO29CQUM3Qiw0QkFBNEIsQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDcEMsS0FBSyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUM7b0JBRXJCLElBQUksV0FBVyxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDO29CQUNyRSxPQUFPLElBQUksMEJBQTBCLENBQUMsV0FBVyxFQUFFLENBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBRSxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQUNoRixDQUFDO2dCQUNELElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUNsQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7b0JBQzdCLDRCQUE0QixDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUNwQyxLQUFLLEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQztvQkFFckIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO29CQUM3Qiw0QkFBNEIsQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDcEMsS0FBSyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUM7b0JBRXJCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztvQkFDN0IsNEJBQTRCLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQ3BDLEtBQUssR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDO29CQUVyQixJQUFJLFdBQVcsR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztvQkFDdkYsT0FBTyxJQUFJLDBCQUEwQixDQUFDLFdBQVcsRUFBRSxDQUFFLFFBQVEsRUFBRSxRQUFRLENBQUUsQ0FBQyxDQUFDO2dCQUM1RSxDQUFDO2dCQUNELElBQUksQ0FBQyxDQUFDO29CQUNMLDRCQUE0QixDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNyQyxDQUFDO1lBQ0YsQ0FBQztZQUVELE1BQU0sQ0FBQyxPQUFPLENBQUM7UUFDaEIsQ0FBQztLQUNELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBISUdIX1NVUlJPR0FURV9NSU4sIEhJR0hfU1VSUk9HQVRFX01BWCwgTE9XX1NVUlJPR0FURV9NSU4sIExPV19TVVJST0dBVEVfTUFYIH0gZnJvbSAnLi9zdHJpbmcnO1xuXG5jb25zdCBCQVNFNjRfS0VZU1RSID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89JztcblxuZnVuY3Rpb24gZGVjb2RlVXRmOEVuY29kZWRDb2RlUG9pbnQoY29kZVBvaW50OiBudW1iZXIsIHZhbGlkYXRpb25SYW5nZTogbnVtYmVyW10gPSBbIDAsIEluZmluaXR5IF0sIGNoZWNrU3Vycm9nYXRlPzogYm9vbGVhbik6IHN0cmluZyB7XG5cdGlmIChjb2RlUG9pbnQgPCB2YWxpZGF0aW9uUmFuZ2VbMF0gfHwgY29kZVBvaW50ID4gdmFsaWRhdGlvblJhbmdlWzFdKSB7XG5cdFx0dGhyb3cgRXJyb3IoJ0ludmFsaWQgY29udGludWF0aW9uIGJ5dGUnKTtcblx0fVxuXG5cdGlmIChjaGVja1N1cnJvZ2F0ZSAmJiBjb2RlUG9pbnQgPj0gSElHSF9TVVJST0dBVEVfTUlOICYmIGNvZGVQb2ludCA8PSBMT1dfU1VSUk9HQVRFX01BWCkge1xuXHRcdHRocm93IEVycm9yKCdTdXJyb2dhdGUgaXMgbm90IGEgc2NhbGFyIHZhbHVlJyk7XG5cdH1cblxuXHRsZXQgZW5jb2RlZCA9ICcnO1xuXG5cdGlmIChjb2RlUG9pbnQgPiAweEZGRkYpIHtcblx0XHRjb2RlUG9pbnQgLT0gMHgwMTAwMDA7XG5cdFx0ZW5jb2RlZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGVQb2ludCA+Pj4gMHgxMCAmIDB4MDNGRiB8IEhJR0hfU1VSUk9HQVRFX01JTik7XG5cdFx0Y29kZVBvaW50ID0gTE9XX1NVUlJPR0FURV9NSU4gfCBjb2RlUG9pbnQgJiAweDAzRkY7XG5cdH1cblxuXHRlbmNvZGVkICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZVBvaW50KTtcblxuXHRyZXR1cm4gZW5jb2RlZDtcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVVdGY4RW5jb2RlZENvZGVQb2ludChjb2RlUG9pbnQ6IG51bWJlcik6IHZvaWQge1xuXHRpZiAoKGNvZGVQb2ludCAmIDB4QzApICE9PSAweDgwKSB7XG5cdFx0dGhyb3cgRXJyb3IoJ0ludmFsaWQgY29udGludWF0aW9uIGJ5dGUnKTtcblx0fVxufVxuXG5leHBvcnQgdHlwZSBCeXRlQnVmZmVyID0gVWludDE2QXJyYXkgfCBVaW50OEFycmF5IHwgQnVmZmVyIHwgbnVtYmVyW107XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29kZWMge1xuXHRlbmNvZGUoZGF0YTogc3RyaW5nKTogbnVtYmVyW107XG5cdGRlY29kZShkYXRhOiBCeXRlQnVmZmVyKTogc3RyaW5nO1xufVxuXG4vKipcbiAqIFByb3ZpZGVzIGZhY2lsaXRpZXMgZm9yIGVuY29kaW5nIGEgc3RyaW5nIGludG8gYW4gQVNDSUktZW5jb2RlZCBieXRlIGJ1ZmZlciBhbmRcbiAqIGRlY29kaW5nIGFuIEFTQ0lJLWVuY29kZWQgYnl0ZSBidWZmZXIgaW50byBhIHN0cmluZy5cbiAqL1xuZXhwb3J0IGNvbnN0IGFzY2lpOiBDb2RlYyA9IHtcblx0LyoqXG5cdCAqIEVuY29kZXMgYSBzdHJpbmcgaW50byBhbiBBU0NJSS1lbmNvZGVkIGJ5dGUgYnVmZmVyLlxuXHQgKlxuXHQgKiBAcGFyYW0gZGF0YSBUaGUgdGV4dCBzdHJpbmcgdG8gZW5jb2RlXG5cdCAqL1xuXHRlbmNvZGUoZGF0YTogc3RyaW5nKTogbnVtYmVyW10ge1xuXHRcdGlmIChkYXRhID09IG51bGwpIHtcblx0XHRcdHJldHVybiBbXTtcblx0XHR9XG5cblx0XHRjb25zdCBidWZmZXI6IG51bWJlcltdID0gW107XG5cblx0XHRmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuXHRcdFx0YnVmZmVyW2ldID0gZGF0YS5jaGFyQ29kZUF0KGkpO1xuXHRcdH1cblxuXHRcdHJldHVybiBidWZmZXI7XG5cdH0sXG5cblx0LyoqXG5cdCAqIERlY29kZXMgYW4gQVNDSUktZW5jb2RlZCBieXRlIGJ1ZmZlciBpbnRvIGEgc3RyaW5nLlxuXHQgKlxuXHQgKiBAcGFyYW0gZGF0YSBUaGUgYnl0ZSBidWZmZXIgdG8gZGVjb2RlXG5cdCAqL1xuXHRkZWNvZGUoZGF0YTogQnl0ZUJ1ZmZlcik6IHN0cmluZyB7XG5cdFx0aWYgKGRhdGEgPT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuICcnO1xuXHRcdH1cblxuXHRcdGxldCBkZWNvZGVkID0gJyc7XG5cblx0XHRmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuXHRcdFx0ZGVjb2RlZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGRhdGFbaV0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBkZWNvZGVkO1xuXHR9XG59O1xuXG4vKipcbiAqIFByb3ZpZGVzIGZhY2lsaXRpZXMgZm9yIGVuY29kaW5nIGEgc3RyaW5nIGludG8gYSBCYXNlNjQtZW5jb2RlZCBieXRlIGJ1ZmZlciBhbmRcbiAqIGRlY29kaW5nIGEgQmFzZTY0LWVuY29kZWQgYnl0ZSBidWZmZXIgaW50byBhIHN0cmluZy5cbiAqL1xuZXhwb3J0IGNvbnN0IGJhc2U2NDogQ29kZWMgPSB7XG5cdC8qKlxuXHQgKiBFbmNvZGVzIGEgQmFzZTY0LWVuY29kZWQgc3RyaW5nIGludG8gYSBCYXNlNjQgYnl0ZSBidWZmZXIuXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSBCYXNlNjQtZW5jb2RlZCBzdHJpbmcgdG8gZW5jb2RlXG5cdCAqL1xuXHRlbmNvZGUoZGF0YTogc3RyaW5nKTogbnVtYmVyW10ge1xuXHRcdGlmIChkYXRhID09IG51bGwpIHtcblx0XHRcdHJldHVybiBbXTtcblx0XHR9XG5cblx0XHRjb25zdCBidWZmZXI6IG51bWJlcltdID0gW107XG5cblx0XHRsZXQgaSA9IDA7XG5cdFx0bGV0IGxlbmd0aCA9IGRhdGEubGVuZ3RoO1xuXG5cdFx0d2hpbGUgKGRhdGFbLS1sZW5ndGhdID09PSAnPScpIHsgfVxuXHRcdHdoaWxlIChpIDwgbGVuZ3RoKSB7XG5cdFx0XHRsZXQgZW5jb2RlZCA9IEJBU0U2NF9LRVlTVFIuaW5kZXhPZihkYXRhW2krK10pIDw8IDE4O1xuXHRcdFx0aWYgKGkgPD0gbGVuZ3RoKSB7XG5cdFx0XHRcdGVuY29kZWQgfD0gQkFTRTY0X0tFWVNUUi5pbmRleE9mKGRhdGFbaSsrXSkgPDwgMTI7XG5cdFx0XHR9XG5cdFx0XHRpZiAoaSA8PSBsZW5ndGgpIHtcblx0XHRcdFx0ZW5jb2RlZCB8PSBCQVNFNjRfS0VZU1RSLmluZGV4T2YoZGF0YVtpKytdKSA8PCA2O1xuXHRcdFx0fVxuXHRcdFx0aWYgKGkgPD0gbGVuZ3RoKSB7XG5cdFx0XHRcdGVuY29kZWQgfD0gQkFTRTY0X0tFWVNUUi5pbmRleE9mKGRhdGFbaSsrXSk7XG5cdFx0XHR9XG5cblx0XHRcdGJ1ZmZlci5wdXNoKChlbmNvZGVkID4+PiAxNikgJiAweGZmKTtcblx0XHRcdGJ1ZmZlci5wdXNoKChlbmNvZGVkID4+PiA4KSAmIDB4ZmYpO1xuXHRcdFx0YnVmZmVyLnB1c2goZW5jb2RlZCAmIDB4ZmYpO1xuXHRcdH1cblxuXHRcdHdoaWxlIChidWZmZXJbYnVmZmVyLmxlbmd0aCAtIDFdID09PSAwKSB7XG5cdFx0XHRidWZmZXIucG9wKCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGJ1ZmZlcjtcblx0fSxcblxuXHQvKipcblx0ICogRGVjb2RlcyBhIEJhc2U2NC1lbmNvZGVkIGJ5dGUgYnVmZmVyIGludG8gYSBCYXNlNjQtZW5jb2RlZCBzdHJpbmcuXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSBieXRlIGJ1ZmZlciB0byBkZWNvZGVcblx0ICovXG5cdGRlY29kZShkYXRhOiBCeXRlQnVmZmVyKTogc3RyaW5nIHtcblx0XHRpZiAoZGF0YSA9PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gJyc7XG5cdFx0fVxuXG5cdFx0bGV0IGRlY29kZWQgPSAnJztcblx0XHRsZXQgaSA9IDA7XG5cblx0XHRmb3IgKGxldCBsZW5ndGggPSBkYXRhLmxlbmd0aCAtIChkYXRhLmxlbmd0aCAlIDMpOyBpIDwgbGVuZ3RoOyApIHtcblx0XHRcdGxldCBlbmNvZGVkID0gZGF0YVtpKytdIDw8IDE2IHwgZGF0YVtpKytdIDw8IDggfCBkYXRhW2krK107XG5cblx0XHRcdGRlY29kZWQgKz0gQkFTRTY0X0tFWVNUUi5jaGFyQXQoKGVuY29kZWQgPj4+IDE4KSAmIDB4M0YpO1xuXHRcdFx0ZGVjb2RlZCArPSBCQVNFNjRfS0VZU1RSLmNoYXJBdCgoZW5jb2RlZCA+Pj4gMTIpICYgMHgzRik7XG5cdFx0XHRkZWNvZGVkICs9IEJBU0U2NF9LRVlTVFIuY2hhckF0KChlbmNvZGVkID4+PiA2KSAmIDB4M0YpO1xuXHRcdFx0ZGVjb2RlZCArPSBCQVNFNjRfS0VZU1RSLmNoYXJBdChlbmNvZGVkICYgMHgzRik7XG5cdFx0fVxuXG5cdFx0aWYgKGRhdGEubGVuZ3RoICUgMyA9PT0gMSkge1xuXHRcdFx0bGV0IGVuY29kZWQgPSBkYXRhW2krK10gPDwgMTY7XG5cdFx0XHRkZWNvZGVkICs9IEJBU0U2NF9LRVlTVFIuY2hhckF0KChlbmNvZGVkID4+PiAxOCkgJiAweDNmKTtcblx0XHRcdGRlY29kZWQgKz0gQkFTRTY0X0tFWVNUUi5jaGFyQXQoKGVuY29kZWQgPj4+IDEyKSAmIDB4M2YpO1xuXHRcdFx0ZGVjb2RlZCArPSAnPT0nO1xuXHRcdH1cblx0XHRlbHNlIGlmIChkYXRhLmxlbmd0aCAlIDMgPT09IDIpIHtcblx0XHRcdGxldCBlbmNvZGVkID0gZGF0YVtpKytdIDw8IDE2IHwgZGF0YVtpKytdIDw8IDg7XG5cdFx0XHRkZWNvZGVkICs9IEJBU0U2NF9LRVlTVFIuY2hhckF0KChlbmNvZGVkID4+PiAxOCkgJiAweDNmKTtcblx0XHRcdGRlY29kZWQgKz0gQkFTRTY0X0tFWVNUUi5jaGFyQXQoKGVuY29kZWQgPj4+IDEyKSAmIDB4M2YpO1xuXHRcdFx0ZGVjb2RlZCArPSBCQVNFNjRfS0VZU1RSLmNoYXJBdCgoZW5jb2RlZCA+Pj4gNikgJiAweDNmKTtcblx0XHRcdGRlY29kZWQgKz0gJz0nO1xuXHRcdH1cblxuXHRcdHJldHVybiBkZWNvZGVkO1xuXHR9XG59O1xuXG4vKipcbiAqIFByb3ZpZGVzIGZhY2lsaXRpZXMgZm9yIGVuY29kaW5nIGEgc3RyaW5nIGludG8gYSBoZXgtZW5jb2RlZCBieXRlIGJ1ZmZlciBhbmRcbiAqIGRlY29kaW5nIGEgaGV4LWVuY29kZWQgYnl0ZSBidWZmZXIgaW50byBhIHN0cmluZy5cbiAqL1xuZXhwb3J0IGNvbnN0IGhleDogQ29kZWMgPSB7XG5cdC8qKlxuXHQgKiBFbmNvZGVzIGEgc3RyaW5nIGludG8gYSBoZXgtZW5jb2RlZCBieXRlIGJ1ZmZlci5cblx0ICpcblx0ICogQHBhcmFtIGRhdGEgVGhlIGhleC1lbmNvZGVkIHN0cmluZyB0byBlbmNvZGVcblx0ICovXG5cdGVuY29kZShkYXRhOiBzdHJpbmcpOiBudW1iZXJbXSB7XG5cdFx0aWYgKGRhdGEgPT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuIFtdO1xuXHRcdH1cblxuXHRcdGNvbnN0IGJ1ZmZlcjogbnVtYmVyW10gPSBbXTtcblxuXHRcdGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSBkYXRhLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSArPSAyKSB7XG5cdFx0XHRsZXQgZW5jb2RlZENoYXIgPSBwYXJzZUludChkYXRhLnN1YnN0cihpLCAyKSwgMTYpO1xuXG5cdFx0XHRidWZmZXIucHVzaChlbmNvZGVkQ2hhcik7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGJ1ZmZlcjtcblx0fSxcblxuXHQvKipcblx0ICogRGVjb2RlcyBhIGhleC1lbmNvZGVkIGJ5dGUgYnVmZmVyIGludG8gYSBoZXgtZW5jb2RlZCBzdHJpbmcuXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSBieXRlIGJ1ZmZlciB0byBkZWNvZGVcblx0ICovXG5cdGRlY29kZShkYXRhOiBCeXRlQnVmZmVyKTogc3RyaW5nIHtcblx0XHRpZiAoZGF0YSA9PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gJyc7XG5cdFx0fVxuXG5cdFx0bGV0IGRlY29kZWQgPSAnJztcblxuXHRcdGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSBkYXRhLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG5cdFx0XHRkZWNvZGVkICs9IGRhdGFbaV0udG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRlY29kZWQ7XG5cdH1cbn07XG5cbi8qKlxuICogUHJvdmlkZXMgZmFjaWxpdGllcyBmb3IgZW5jb2RpbmcgYSBzdHJpbmcgaW50byBhIFVURi04LWVuY29kZWQgYnl0ZSBidWZmZXIgYW5kXG4gKiBkZWNvZGluZyBhIFVURi04LWVuY29kZWQgYnl0ZSBidWZmZXIgaW50byBhIHN0cmluZy5cbiAqIEluc3BpcmVkIGJ5IHRoZSB3b3JrIG9mOiBodHRwczovL2dpdGh1Yi5jb20vbWF0aGlhc2J5bmVucy91dGY4LmpzXG4gKi9cbmV4cG9ydCBjb25zdCB1dGY4OiBDb2RlYyA9IHtcblx0LyoqXG5cdCAqIEVuY29kZXMgYSBzdHJpbmcgaW50byBhIFVURi04LWVuY29kZWQgYnl0ZSBidWZmZXIuXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSB0ZXh0IHN0cmluZyB0byBlbmNvZGVcblx0ICovXG5cdGVuY29kZShkYXRhOiBzdHJpbmcpOiBudW1iZXJbXSB7XG5cdFx0aWYgKGRhdGEgPT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuIFtdO1xuXHRcdH1cblxuXHRcdGNvbnN0IGJ1ZmZlcjogbnVtYmVyW10gPSBbXTtcblxuXHRcdGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSBkYXRhLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG5cdFx0XHRsZXQgZW5jb2RlZENoYXIgPSBkYXRhLmNoYXJDb2RlQXQoaSk7XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogU3Vycm9nYXRlc1xuXHRcdFx0ICogaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Vbml2ZXJzYWxfQ2hhcmFjdGVyX1NldF9jaGFyYWN0ZXJzXG5cdFx0XHQgKi9cblx0XHRcdGlmIChlbmNvZGVkQ2hhciA+PSBISUdIX1NVUlJPR0FURV9NSU4gJiYgZW5jb2RlZENoYXIgPD0gSElHSF9TVVJST0dBVEVfTUFYKSB7XG5cdFx0XHRcdGxldCBsb3dTdXJyb2dhdGUgPSBkYXRhLmNoYXJDb2RlQXQoaSArIDEpO1xuXHRcdFx0XHRpZiAobG93U3Vycm9nYXRlID49IExPV19TVVJST0dBVEVfTUlOICYmIGxvd1N1cnJvZ2F0ZSA8PSBMT1dfU1VSUk9HQVRFX01BWCkge1xuXHRcdFx0XHRcdGVuY29kZWRDaGFyID0gMHgwMTAwMDAgKyAoZW5jb2RlZENoYXIgLSBISUdIX1NVUlJPR0FURV9NSU4pICogMHgwNDAwICsgKGxvd1N1cnJvZ2F0ZSAtIExPV19TVVJST0dBVEVfTUlOKTtcblx0XHRcdFx0XHRpKys7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGVuY29kZWRDaGFyIDwgMHg4MCkge1xuXHRcdFx0XHRidWZmZXIucHVzaChlbmNvZGVkQ2hhcik7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0aWYgKGVuY29kZWRDaGFyIDwgMHg4MDApIHtcblx0XHRcdFx0XHRidWZmZXIucHVzaCgoKGVuY29kZWRDaGFyID4+IDB4MDYpICYgMHgxRikgfCAweEMwKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlIGlmIChlbmNvZGVkQ2hhciA8IDB4MDEwMDAwKSB7XG5cdFx0XHRcdFx0aWYgKGVuY29kZWRDaGFyID49IEhJR0hfU1VSUk9HQVRFX01JTiAmJiBlbmNvZGVkQ2hhciA8PSBMT1dfU1VSUk9HQVRFX01BWCkge1xuXHRcdFx0XHRcdFx0dGhyb3cgRXJyb3IoJ1N1cnJvZ2F0ZSBpcyBub3QgYSBzY2FsYXIgdmFsdWUnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRidWZmZXIucHVzaCgoKGVuY29kZWRDaGFyID4+IDB4MEMpICYgMHgwRikgfCAweEUwKTtcblx0XHRcdFx0XHRidWZmZXIucHVzaCgoKGVuY29kZWRDaGFyID4+IDB4MDYpICYgMHgzRikgfCAweDgwKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlIGlmIChlbmNvZGVkQ2hhciA8IDB4MjAwMDAwKSB7XG5cdFx0XHRcdFx0YnVmZmVyLnB1c2goKChlbmNvZGVkQ2hhciA+PiAweDEyKSAmIDB4MDcpIHwgMHhGMCk7XG5cdFx0XHRcdFx0YnVmZmVyLnB1c2goKChlbmNvZGVkQ2hhciA+PiAweDBDKSAmIDB4M0YpIHwgMHg4MCk7XG5cdFx0XHRcdFx0YnVmZmVyLnB1c2goKChlbmNvZGVkQ2hhciA+PiAweDA2KSAmIDB4M0YpIHwgMHg4MCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnVmZmVyLnB1c2goKGVuY29kZWRDaGFyICYgMHgzRikgfCAweDgwKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gYnVmZmVyO1xuXHR9LFxuXG5cdC8qKlxuXHQgKiBEZWNvZGVzIGEgVVRGLTgtZW5jb2RlZCBieXRlIGJ1ZmZlciBpbnRvIGEgc3RyaW5nLlxuXHQgKlxuXHQgKiBAcGFyYW0gZGF0YSBUaGUgYnl0ZSBidWZmZXIgdG8gZGVjb2RlXG5cdCAqL1xuXHRkZWNvZGUoZGF0YTogQnl0ZUJ1ZmZlcik6IHN0cmluZyB7XG5cdFx0aWYgKGRhdGEgPT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuICcnO1xuXHRcdH1cblxuXHRcdGxldCBkZWNvZGVkID0gJyc7XG5cblx0XHRmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuXHRcdFx0bGV0IGJ5dGUxID0gZGF0YVtpXSAmIDB4RkY7XG5cblx0XHRcdGlmICgoYnl0ZTEgJiAweDgwKSA9PT0gMCkge1xuXHRcdFx0XHRkZWNvZGVkICs9IGRlY29kZVV0ZjhFbmNvZGVkQ29kZVBvaW50KGJ5dGUxKTtcblx0XHRcdH1cblx0XHRcdGVsc2UgaWYgKChieXRlMSAmIDB4RTApID09PSAweEMwKSB7XG5cdFx0XHRcdGxldCBieXRlMiA9IGRhdGFbKytpXSAmIDB4RkY7XG5cdFx0XHRcdHZhbGlkYXRlVXRmOEVuY29kZWRDb2RlUG9pbnQoYnl0ZTIpO1xuXHRcdFx0XHRieXRlMiA9IGJ5dGUyICYgMHgzRjtcblx0XHRcdFx0bGV0IGVuY29kZWRCeXRlID0gKChieXRlMSAmIDB4MUYpIDw8IDB4MDYpIHwgYnl0ZTI7XG5cdFx0XHRcdGRlY29kZWQgKz0gZGVjb2RlVXRmOEVuY29kZWRDb2RlUG9pbnQoZW5jb2RlZEJ5dGUsIFsweDgwLCBJbmZpbml0eV0pO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSBpZiAoKGJ5dGUxICYgMHhGMCkgPT09IDB4RTApIHtcblx0XHRcdFx0bGV0IGJ5dGUyID0gZGF0YVsrK2ldICYgMHhGRjtcblx0XHRcdFx0dmFsaWRhdGVVdGY4RW5jb2RlZENvZGVQb2ludChieXRlMik7XG5cdFx0XHRcdGJ5dGUyID0gYnl0ZTIgJiAweDNGO1xuXG5cdFx0XHRcdGxldCBieXRlMyA9IGRhdGFbKytpXSAmIDB4RkY7XG5cdFx0XHRcdHZhbGlkYXRlVXRmOEVuY29kZWRDb2RlUG9pbnQoYnl0ZTMpO1xuXHRcdFx0XHRieXRlMyA9IGJ5dGUzICYgMHgzRjtcblxuXHRcdFx0XHRsZXQgZW5jb2RlZEJ5dGUgPSAoKGJ5dGUxICYgMHgxRikgPDwgMHgwQykgfCAoYnl0ZTIgPDwgMHgwNikgfCBieXRlMztcblx0XHRcdFx0ZGVjb2RlZCArPSBkZWNvZGVVdGY4RW5jb2RlZENvZGVQb2ludChlbmNvZGVkQnl0ZSwgWyAweDA4MDAsIEluZmluaXR5IF0sIHRydWUpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSBpZiAoKGJ5dGUxICYgMHhGOCkgPT09IDB4RjApIHtcblx0XHRcdFx0bGV0IGJ5dGUyID0gZGF0YVsrK2ldICYgMHhGRjtcblx0XHRcdFx0dmFsaWRhdGVVdGY4RW5jb2RlZENvZGVQb2ludChieXRlMik7XG5cdFx0XHRcdGJ5dGUyID0gYnl0ZTIgJiAweDNGO1xuXG5cdFx0XHRcdGxldCBieXRlMyA9IGRhdGFbKytpXSAmIDB4RkY7XG5cdFx0XHRcdHZhbGlkYXRlVXRmOEVuY29kZWRDb2RlUG9pbnQoYnl0ZTMpO1xuXHRcdFx0XHRieXRlMyA9IGJ5dGUzICYgMHgzRjtcblxuXHRcdFx0XHRsZXQgYnl0ZTQgPSBkYXRhWysraV0gJiAweEZGO1xuXHRcdFx0XHR2YWxpZGF0ZVV0ZjhFbmNvZGVkQ29kZVBvaW50KGJ5dGU0KTtcblx0XHRcdFx0Ynl0ZTQgPSBieXRlNCAmIDB4M0Y7XG5cblx0XHRcdFx0bGV0IGVuY29kZWRCeXRlID0gKChieXRlMSAmIDB4MUYpIDw8IDB4MEMpIHwgKGJ5dGUyIDw8IDB4MEMpIHwgKGJ5dGUzIDw8IDB4MDYpIHwgYnl0ZTQ7XG5cdFx0XHRcdGRlY29kZWQgKz0gZGVjb2RlVXRmOEVuY29kZWRDb2RlUG9pbnQoZW5jb2RlZEJ5dGUsIFsgMHgwMTAwMDAsIDB4MTBGRkZGIF0pO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHZhbGlkYXRlVXRmOEVuY29kZWRDb2RlUG9pbnQoYnl0ZTEpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBkZWNvZGVkO1xuXHR9XG59O1xuIl19